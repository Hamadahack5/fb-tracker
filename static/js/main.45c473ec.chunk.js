(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{220:function(e,t,a){e.exports=a(411)},411:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),o=a(55),i=a.n(o),l=a(186),c=a(187),r=a(207),u=a(188),d=a(208),m=a(17),g=a(35),p=a.n(g),h=a(189),v=a(91),f=a.n(v),k=a(420),b=a(421),E=a(428),_=a(429),w=a(90),S=a(424),I=a(422),C=a(423),D=a(427),y=a(426),O=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(r.a)(this,Object(u.a)(t).call(this,e))).addToList=function(e){e.preventDefault(),a.getMetrics(a.state.currentValue)},a.getMetricsRefresh=function(e){var t,n;a.setState({loading:!0});var s,o=e.type,i=e.postId;a.state.facebookData.forEach(function(a){e.pageId===a.value&&(t=a)}),s="video"===o?"/".concat(t.value,"_").concat(i,"/?fields=insights.metric(post_impressions,post_impressions_unique,post_video_views),name,message,created_time"):"/".concat(t.value,"_").concat(i,"/?fields=insights.metric(post_impressions,post_impressions_unique,post_clicks),name,message,created_time"),window.FB.api(s,{access_token:t.access_token},function(s){n="video"===o?{link:e.link,postId:i,pageId:t.value,pageName:t.text,type:o,name:s.name,message:s.message,created_time:new Date(s.created_time).toLocaleString("en-SG"),impressions:s.insights.data[2].values[0].value,reach:s.insights.data[3].values[0].value,engagement:s.insights.data[1].values[0].value}:{link:e.link,postId:i,pageId:t.value,pageName:t.text,type:o,name:s.name,message:s.message,created_time:new Date(s.created_time).toLocaleString("en-SG"),impressions:s.insights.data[0].values[0].value,reach:s.insights.data[1].values[0].value,engagement:s.insights.data[2].values[0].value};var l=a.state.data;l.push(n),a.setState({data:l}),a.saveToDB(),a.setState({loading:!1})})},a.getMetrics=function(e){var t,n,s,o,i;a.state.facebookData.forEach(function(e){a.state.currentPage===e.value&&(t=e)}),e.includes("videos")?(s="video",o=e.slice(0,-1).split("/").pop(),i="/".concat(t.value,"_").concat(o,"/?fields=insights.metric(post_impressions,post_impressions_unique,post_video_views),name,message,created_time")):(s="posts",o=e.split("/").pop(),i="/".concat(t.value,"_").concat(o,"/?fields=insights.metric(post_impressions,post_impressions_unique,post_clicks),name,message,created_time")),window.FB.api(i,{access_token:t.access_token},function(i){n="video"===s?{link:e,postId:o,pageId:t.value,pageName:t.text,type:s,name:i.name,message:i.message,created_time:new Date(i.created_time).toLocaleString("en-SG"),impressions:i.insights.data[2].values[0].value,reach:i.insights.data[3].values[0].value,engagement:i.insights.data[1].values[0].value}:{link:e,postId:o,pageId:t.value,pageName:t.text,type:s,name:i.name,message:i.message,created_time:new Date(i.created_time).toLocaleString("en-SG"),impressions:i.insights.data[0].values[0].value,reach:i.insights.data[1].values[0].value,engagement:i.insights.data[2].values[0].value};var l=a.state.data;l.push(n),a.setState({data:l}),a.saveToDB()})},a.deleteRow=function(e){console.log(e);var t=a.state.data,n=f.a.remove(t,function(t){if(t.postId===e)return!0});a.setState({data:t}),a.saveToDB(),p.a.firestore().collection("records").doc(a.state.appUserID).set({archive:n},{merge:!0})},a.handleInputChange=function(e){a.setState({currentValue:e.target.value.split("?")[0]})},a.handleDropdownChange=function(e,t){var n=t.value;a.setState({currentPage:n})},a.handleSort=function(e){return function(){var t=a.state,n=t.column,s=t.data,o=t.direction;n===e?a.setState({data:s.reverse(),direction:"ascending"===o?"descending":"ascending"}):a.setState({column:e,data:f.a.sortBy(s,[e]),direction:"ascending"})}},a.state={accessToken:"",currentValue:"",currentPage:"",data:[],oldData:[],facebookData:[],items:[],loading:!1,appUserID:"",column:null,direction:null},a.loadFacebook=a.loadFacebook.bind(Object(m.a)(Object(m.a)(a))),a.addToList=a.addToList.bind(Object(m.a)(Object(m.a)(a))),a.forceRefresh=a.forceRefresh.bind(Object(m.a)(Object(m.a)(a))),a.firebaseUI=a.firebaseUI.bind(Object(m.a)(Object(m.a)(a))),a.deleteRow=a.deleteRow.bind(Object(m.a)(Object(m.a)(a))),a.signOut=a.signOut.bind(Object(m.a)(Object(m.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.loadFacebook();p.a.initializeApp({apiKey:"AIzaSyCi8s6wYR8LT2hTLwOgEAmduO_3qZE_ohE",authDomain:"facebooktest-f856a.firebaseapp.com",projectId:"facebooktest-f856a"}),p.a.auth().onAuthStateChanged(function(t){t?(e.loginFacebook(),e.setState({appUserID:t.uid}),e.setState({loading:!0})):e.firebaseUI()})}},{key:"firebaseUI",value:function(){var e=this,t=new h.auth.AuthUI(p.a.auth()),a={callbacks:{signInSuccessWithAuthResult:function(t,a){return console.log(t),e.setState({accessToken:t.credential.accessToken}),e.loginFacebook(),!1}},signInFlow:"popup",signInOptions:[{provider:p.a.auth.FacebookAuthProvider.PROVIDER_ID,scopes:["manage_pages","read_insights"]}]};t.start("#firebaseui-auth-container",a)}},{key:"signOut",value:function(){p.a.auth().signOut()}},{key:"loadFacebook",value:function(){!function(e,t,a){var n,s=e.getElementsByTagName(t)[0];e.getElementById(a)||((n=e.createElement(t)).id=a,n.src="https://connect.facebook.net/en_US/sdk.js",s.parentNode.insertBefore(n,s))}(document,"script","facebook-jssdk"),window.fbAsyncInit=function(){window.FB.init({appId:"1497929310342175",autoLogAppEvents:!0,xfbml:!0,version:"v3.2",state:!0})}}},{key:"loginFacebook",value:function(){var e=this;window.FB.getLoginStatus(function(t){"connected"===t.status?window.FB.api("/me/accounts?fields=id,name,access_token",function(t){e.setState({facebookData:t.data}),e.getFromDB(),e.populateSelect()}):console.log("Login Failed!")})}},{key:"getFromDB",value:function(){var e=this;p.a.firestore().collection("records").doc(this.state.appUserID).get().then(function(t){t.exists?(e.setState({data:t.data().data}),e.setState({loading:!1})):(console.log("No such document!"),e.setState({loading:!1}))}).catch(function(e){console.log("Error getting document",e)})}},{key:"saveToDB",value:function(){p.a.firestore().collection("records").doc(this.state.appUserID).set({data:this.state.data})}},{key:"loader",value:function(){return this.state.loading?s.a.createElement(k.a,{active:!0}):s.a.createElement(k.a,{disabled:!0})}},{key:"forceRefresh",value:function(){var e=this;this.setState({oldData:this.state.data,data:[]}),this.state.data.forEach(function(t){e.getMetricsRefresh(t)})}},{key:"populateSelect",value:function(){var e=[];this.state.facebookData.forEach(function(t){e.push({value:t.id,text:t.name,access_token:t.access_token})}),e.sort(function(e,t){return e.text.localeCompare(t.text)}),this.setState({facebookData:e})}},{key:"render",value:function(){var e=this,t=this.state,a=t.column,n=t.direction;return s.a.createElement("div",{className:"App"},s.a.createElement(b.a,null,s.a.createElement(E.a,{centered:!0,padded:!0,columns:1,divided:!0},s.a.createElement(E.a.Row,null,s.a.createElement(E.a.Column,null,s.a.createElement(_.a,{as:"h1",icon:!0,textAlign:"center"},s.a.createElement(w.a,{name:"facebook"}),s.a.createElement(_.a.Content,null,"Facebook Insights Tracker")),s.a.createElement("div",{id:"firebaseui-auth-container"}))),s.a.createElement(E.a.Row,null,s.a.createElement(E.a.Column,null,s.a.createElement(S.a,{onSubmit:this.addToList},s.a.createElement(I.a,{defaultValue:this.state.currentValue,onChange:this.handleInputChange,fluid:!0,required:!0,placeholder:"Link",type:"url"},s.a.createElement("input",null),s.a.createElement(C.a,{placeholder:"Page",options:this.state.facebookData,onChange:this.handleDropdownChange}),s.a.createElement(D.a,{type:"submit"},s.a.createElement(w.a,{fitted:!0,name:"add"})))))),s.a.createElement(E.a.Row,null,s.a.createElement(E.a.Column,null,s.a.createElement(D.a,{positive:!0,content:"Force Refresh",onClick:this.forceRefresh}),s.a.createElement(D.a,{content:"Sign Out",onClick:this.signOut}))),s.a.createElement(E.a.Row,null,s.a.createElement(E.a.Column,null,this.loader(),s.a.createElement(y.a,{striped:!0,compact:!0,sortable:!0,fixed:!0,singleLine:!0},s.a.createElement(y.a.Header,null,s.a.createElement(y.a.Row,null,s.a.createElement(y.a.HeaderCell,null,"Page"),s.a.createElement(y.a.HeaderCell,null,"Name"),s.a.createElement(y.a.HeaderCell,null,"Message"),s.a.createElement(y.a.HeaderCell,{sorted:"impressions"===a?n:null,onClick:this.handleSort("impressions")},"Impressions"),s.a.createElement(y.a.HeaderCell,{sorted:"reach"===a?n:null,onClick:this.handleSort("reach")},"Reach"),s.a.createElement(y.a.HeaderCell,{sorted:"engagement"===a?n:null,onClick:this.handleSort("engagement")},"Engagement"),s.a.createElement(y.a.HeaderCell,null,"Action"))),s.a.createElement(y.a.Body,null,f.a.map(this.state.data,function(t){var a=t.pageName,n=t.postId,o=t.name,i=t.message,l=t.impressions,c=t.reach,r=t.engagement,u=t.link,d=t.type;return s.a.createElement(y.a.Row,null,s.a.createElement(y.a.Cell,null,a),s.a.createElement(y.a.Cell,null,o),s.a.createElement(y.a.Cell,null,i),s.a.createElement(y.a.Cell,null,l.toLocaleString()),s.a.createElement(y.a.Cell,null,c.toLocaleString()),s.a.createElement(y.a.Cell,null,s.a.createElement("p",null,"video"===d?"Video Views ":"Post Clicks "),r.toLocaleString()),s.a.createElement(y.a.Cell,{textAlign:"center"},s.a.createElement("a",{href:u,target:"_blank",rel:"noopener noreferrer"},s.a.createElement(D.a,{basic:!0,color:"blue",icon:"eye"})),s.a.createElement(D.a,{basic:!0,color:"red",icon:"remove",onClick:function(){return e.deleteRow(n)}})))}))))))))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(404),a(407);i.a.render(s.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[220,2,1]]]);
//# sourceMappingURL=main.45c473ec.chunk.js.map
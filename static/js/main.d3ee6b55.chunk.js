(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{221:function(e,a,t){e.exports=t(412)},412:function(e,a,t){"use strict";t.r(a);var n=t(0),o=t.n(n),l=t(55),s=t.n(l),c=t(186),i=t(187),r=t(208),u=t(188),d=t(209),m=t(18),g=t(35),p=t.n(g),h=t(189),f=t(92),v=t.n(f),E=t(190),b=t.n(E),k=t(421),w=t(422),_=t(429),S=t(430),I=t(91),C=t(431),y=t(90),D=t(425),O=t(423),F=t(424),L=t(428),R=t(427),j=function(e){function a(e){var t;return Object(c.a)(this,a),(t=Object(r.a)(this,Object(u.a)(a).call(this,e))).addToList=function(e){e.preventDefault(),t.getMetrics(t.state.currentValue)},t.getMetricsRefresh=function(e){var a,n;t.setState({loading:!0});var o,l=e.type,s=e.postId;t.state.facebookData.forEach(function(t){e.pageId===t.value&&(a=t)}),o="video"===l?"/".concat(a.value,"_").concat(s,"/?fields=insights.metric(post_impressions,post_impressions_unique,post_video_views),name,message,created_time"):"/".concat(a.value,"_").concat(s,"/?fields=insights.metric(post_impressions,post_impressions_unique,post_clicks),name,message,created_time"),window.FB.api(o,{access_token:a.access_token},function(o){n="video"===l?{link:e.link,postId:s,pageId:a.value,pageName:a.text,type:l,name:o.name,message:o.message,created_time:new Date(o.created_time).toLocaleString("en-SG"),impressions:o.insights.data[2].values[0].value,reach:o.insights.data[3].values[0].value,engagement:o.insights.data[1].values[0].value}:{link:e.link,postId:s,pageId:a.value,pageName:a.text,type:l,name:o.name,message:o.message,created_time:new Date(o.created_time).toLocaleString("en-SG"),impressions:o.insights.data[0].values[0].value,reach:o.insights.data[1].values[0].value,engagement:o.insights.data[2].values[0].value};var c=t.state.data;c.push(n),t.setState({data:c}),t.saveToDB(),t.setState({loading:!1})})},t.getMetrics=function(e){var a,n,o,l,s;t.state.facebookData.forEach(function(e){t.state.currentPage===e.value&&(a=e)}),e.includes("videos")?(o="video",l=e.slice(0,-1).split("/").pop(),s="/".concat(a.value,"_").concat(l,"/?fields=insights.metric(post_impressions,post_impressions_unique,post_video_views),name,message,created_time")):(o="posts",l=e.split("/").pop(),s="/".concat(a.value,"_").concat(l,"/?fields=insights.metric(post_impressions,post_impressions_unique,post_clicks),name,message,created_time")),window.FB.api(s,{access_token:a.access_token},function(s){n="video"===o?{link:e,postId:l,pageId:a.value,pageName:a.text,type:o,name:s.name,message:s.message,created_time:new Date(s.created_time).toLocaleString("en-SG"),impressions:s.insights.data[2].values[0].value,reach:s.insights.data[3].values[0].value,engagement:s.insights.data[1].values[0].value}:{link:e,postId:l,pageId:a.value,pageName:a.text,type:o,name:s.name,message:s.message,created_time:new Date(s.created_time).toLocaleString("en-SG"),impressions:s.insights.data[0].values[0].value,reach:s.insights.data[1].values[0].value,engagement:s.insights.data[2].values[0].value};var c=t.state.data;c.push(n),t.setState({data:c}),t.saveToDB()})},t.deleteRow=function(e){var a=t.state.data,n=v.a.remove(a,function(a){if(a.postId===e)return!0});t.setState({data:a}),t.saveToDB();var o=p.a.firestore();o.collection("records").doc(t.state.appUserID).get().then(function(e){if(e.exists)if(void 0!==e.data().archive){var a=e.data().archive;a.push(n[0]),o.collection("records").doc(t.state.appUserID).set({archive:a},{merge:!0})}else o.collection("records").doc(t.state.appUserID).set({archive:n},{merge:!0});else console.log("No such document!")}).catch(function(e){console.log("Error getting document",e)})},t.handleInputChange=function(e){t.setState({currentValue:e.target.value.split("?")[0]})},t.handleDropdownChange=function(e,a){var n=a.value;t.setState({currentPage:n})},t.handleSort=function(e){return function(){var a=t.state,n=a.column,o=a.data,l=a.direction;n===e?t.setState({data:o.reverse(),direction:"ascending"===l?"descending":"ascending"}):t.setState({column:e,data:v.a.sortBy(o,[e]),direction:"ascending"})}},t.state={accessToken:"",currentValue:"",currentPage:"",data:[],oldData:[],facebookData:[],items:[],loading:!1,appUserID:"",column:null,direction:null},t.loadFacebook=t.loadFacebook.bind(Object(m.a)(Object(m.a)(t))),t.addToList=t.addToList.bind(Object(m.a)(Object(m.a)(t))),t.forceRefresh=t.forceRefresh.bind(Object(m.a)(Object(m.a)(t))),t.firebaseUI=t.firebaseUI.bind(Object(m.a)(Object(m.a)(t))),t.deleteRow=t.deleteRow.bind(Object(m.a)(Object(m.a)(t))),t.signOut=t.signOut.bind(Object(m.a)(Object(m.a)(t))),t}return Object(d.a)(a,e),Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.loadFacebook();p.a.initializeApp({apiKey:"AIzaSyCi8s6wYR8LT2hTLwOgEAmduO_3qZE_ohE",authDomain:"facebooktest-f856a.firebaseapp.com",projectId:"facebooktest-f856a"}),p.a.auth().onAuthStateChanged(function(a){a?(e.loginFacebook(),e.setState({appUserID:a.uid}),e.setState({loading:!0})):e.firebaseUI()})}},{key:"firebaseUI",value:function(){var e=this,a=new h.auth.AuthUI(p.a.auth()),t={callbacks:{signInSuccessWithAuthResult:function(a,t){return e.setState({accessToken:a.credential.accessToken}),e.loginFacebook(),!1}},signInFlow:"popup",signInOptions:[{provider:p.a.auth.FacebookAuthProvider.PROVIDER_ID,scopes:["manage_pages","read_insights"]}]};a.start("#firebaseui-auth-container",t)}},{key:"signOut",value:function(){p.a.auth().signOut()}},{key:"loadFacebook",value:function(){!function(e,a,t){var n,o=e.getElementsByTagName(a)[0];e.getElementById(t)||((n=e.createElement(a)).id=t,n.src="https://connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(n,o))}(document,"script","facebook-jssdk"),window.fbAsyncInit=function(){window.FB.init({appId:"1497929310342175",autoLogAppEvents:!0,xfbml:!0,version:"v3.2",state:!0})}}},{key:"loginFacebook",value:function(){var e=this;window.FB.getLoginStatus(function(a){"connected"===a.status?window.FB.api("/me/accounts?fields=id,name,access_token",function(a){e.setState({facebookData:a.data}),e.getFromDB(),e.populateSelect()}):console.log("Login Failed!")})}},{key:"getFromDB",value:function(){var e=this;p.a.firestore().collection("records").doc(this.state.appUserID).get().then(function(a){a.exists?e.setState({loading:!1,data:a.data().data}):(console.log("No such document!"),e.setState({loading:!1}))}).catch(function(e){console.log("Error getting document",e)})}},{key:"saveToDB",value:function(){p.a.firestore().collection("records").doc(this.state.appUserID).set({data:this.state.data},{merge:!0})}},{key:"loader",value:function(){return this.state.loading?o.a.createElement(k.a,{active:!0}):o.a.createElement(k.a,{disabled:!0})}},{key:"forceRefresh",value:function(){var e=this;this.setState({oldData:this.state.data,data:[]}),this.state.data.forEach(function(a){e.getMetricsRefresh(a)})}},{key:"populateSelect",value:function(){var e=[];this.state.facebookData.forEach(function(a){e.push({value:a.id,text:a.name,access_token:a.access_token})}),e.sort(function(e,a){return e.text.localeCompare(a.text)}),this.setState({facebookData:e})}},{key:"render",value:function(){var e=this,a=this.state,t=a.column,n=a.direction;return o.a.createElement("div",{className:"App"},o.a.createElement(w.a,{fluid:!0},o.a.createElement(_.a,{centered:!0,padded:!0,columns:3},o.a.createElement(_.a.Row,{centered:!0},o.a.createElement(_.a.Column,{width:3}),o.a.createElement(_.a.Column,{width:10},o.a.createElement(S.a,{as:"h1",icon:!0,textAlign:"center"},o.a.createElement(I.a,{name:"facebook"}),o.a.createElement(S.a.Content,null,"Facebook Insights Tracker")),o.a.createElement("div",{id:"firebaseui-auth-container"})),o.a.createElement(_.a.Column,{width:3},o.a.createElement(C.a,null,o.a.createElement(S.a,null,"Legend"),o.a.createElement(o.a.Fragment,null,o.a.createElement(y.a,{circular:!0,color:"red",empty:!0})," < 25,000"),o.a.createElement("br",null),o.a.createElement(o.a.Fragment,null,o.a.createElement(y.a,{circular:!0,color:"orange",empty:!0})," < 50,000"),o.a.createElement("br",null),o.a.createElement(o.a.Fragment,null,o.a.createElement(y.a,{circular:!0,color:"yellow",empty:!0})," < 100,000"),o.a.createElement("br",null),o.a.createElement(o.a.Fragment,null,o.a.createElement(y.a,{circular:!0,color:"green",empty:!0})," < 500,000"),o.a.createElement("br",null),o.a.createElement(o.a.Fragment,null,o.a.createElement(y.a,{circular:!0,color:"blue",empty:!0})," > 500,000")))),o.a.createElement(_.a.Row,null,o.a.createElement(_.a.Column,{width:10},o.a.createElement(D.a,{onSubmit:this.addToList},o.a.createElement(O.a,{defaultValue:this.state.currentValue,onChange:this.handleInputChange,fluid:!0,required:!0,placeholder:"Link",type:"url"},o.a.createElement("input",null),o.a.createElement(F.a,{placeholder:"Page",options:this.state.facebookData,onChange:this.handleDropdownChange}),o.a.createElement(L.a,{type:"submit"},o.a.createElement(I.a,{fitted:!0,name:"add"})))))),o.a.createElement(_.a.Row,null,o.a.createElement(_.a.Column,{width:10},o.a.createElement(L.a,{positive:!0,content:"Force Refresh",onClick:this.forceRefresh}),o.a.createElement(L.a,{content:"Sign Out",onClick:this.signOut}))),o.a.createElement(_.a.Row,null,o.a.createElement(_.a.Column,{width:10},this.loader(),o.a.createElement(R.a,{striped:!0,compact:!0,sortable:!0,fixed:!0,singleLine:!0},o.a.createElement(R.a.Header,null,o.a.createElement(R.a.Row,null,o.a.createElement(R.a.HeaderCell,null,"Page"),o.a.createElement(R.a.HeaderCell,null,"Name"),o.a.createElement(R.a.HeaderCell,{sorted:"impressions"===t?n:null,onClick:this.handleSort("impressions")},"Impressions"),o.a.createElement(R.a.HeaderCell,{sorted:"reach"===t?n:null,onClick:this.handleSort("reach")},"Reach"),o.a.createElement(R.a.HeaderCell,{sorted:"engagement"===t?n:null,onClick:this.handleSort("engagement")},"Engagement"),o.a.createElement(R.a.HeaderCell,null,"Days Posted"),o.a.createElement(R.a.HeaderCell,null,"Action"))),o.a.createElement(R.a.Body,null,v.a.map(this.state.data,function(a){var t=a.pageName,n=a.postId,l=a.name,s=a.impressions,c=a.reach,i=a.engagement,r=a.link,u=a.type,d=a.created_time;return o.a.createElement(R.a.Row,null,o.a.createElement(R.a.Cell,null,t),o.a.createElement(R.a.Cell,null,l),o.a.createElement(R.a.Cell,null,s.toLocaleString()),o.a.createElement(R.a.Cell,null,c<25e3?o.a.createElement(y.a,{color:"red",size:"large"},o.a.createElement(I.a,{name:"warning sign"}),c.toLocaleString()):c<5e4?o.a.createElement(y.a,{color:"orange",size:"large"},o.a.createElement(I.a,{name:"attention"}),c.toLocaleString()):c<1e5?o.a.createElement(y.a,{color:"yellow",size:"large"},o.a.createElement(I.a,{name:"star half full"}),c.toLocaleString()):c<5e5?o.a.createElement(y.a,{color:"green",size:"large"},o.a.createElement(I.a,{name:"star full"}),c.toLocaleString()):o.a.createElement(y.a,{color:"blue",size:"large"},o.a.createElement(I.a,{name:"diamond"}),c.toLocaleString())),o.a.createElement(R.a.Cell,null,o.a.createElement("p",null,"video"===u?"Video Views ":"Post Clicks "),i.toLocaleString()),o.a.createElement(R.a.Cell,null,b()(d,"DD/MM/YYYY h:mm a").fromNow()),o.a.createElement(R.a.Cell,{textAlign:"center"},o.a.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer"},o.a.createElement(L.a,{basic:!0,color:"blue",icon:"eye"})),o.a.createElement(L.a,{basic:!0,color:"red",icon:"trash alternate outline",onClick:function(){return e.deleteRow(n)}})))}))))))))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));t(405),t(408);s.a.render(o.a.createElement(j,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[221,2,1]]]);
//# sourceMappingURL=main.d3ee6b55.chunk.js.map